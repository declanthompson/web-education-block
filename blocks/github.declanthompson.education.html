{{/* Education Block */}}
{{/* Modified from Wowchemy Blocks: Experience */}}
{{/* https://github.com/wowchemy/wowchemy-hugo-themes/blob/main/modules/wowchemy/layouts/partials/blocks/v1/experience.html */}}
{{/* Additional code from https://github.com/wowchemy/wowchemy-hugo-themes/blob/main/modules/wowchemy/layouts/partials/functions/parse_block_v2.html */}}
{{/* Documentation: https://wowchemy.com/blocks/ */}}
{{/* License: https://github.com/wowchemy/wowchemy-hugo-themes/blob/main/LICENSE.md */}}

{{ $page := .page }}
{{ $block := .block }}

{{ $wcPage := .wcPage }}
{{ $wcBlock := .wcBlock }}

{{ $block_type := lower $block.block | default "markdown" }}
{{ $block_path := printf "blocks/%s.html" $block_type }}
{{ if not (templates.Exists (printf "partials/%s" $block_path)) }}
  {{ errorf "%s uses a `%s` block but the `%s` block was not found at `layouts/partials/%s`" $block.File.Path $block_type $block_type $block_path }}
{{ end }}

{{/* Workaround to make Hugo's .Page.Store.Set cascade up to the parent of headless pages */}}
{{ if $block.Page.Store.Get "has_mermaid" }}
  {{ $page.Page.Store.Set "has_mermaid" true }}
{{ end }}

{{/* Begin widget styling */}}
{{ $bg := $block.design.background }}
{{ $style := "" }}
{{ $style_bg := "" }}

{{ if $bg.color }}
  {{ $style_bg = "transparent" }}
{{ end }}

{{ if and $bg.gradient_start $bg.gradient_end }}
  {{ $angle := string $bg.gradient_angle | default "90" }}
  {{ $style_bg = printf "%sbackground-image: linear-gradient(%sdeg, %s, %s);" $style_bg $angle $bg.gradient_start $bg.gradient_end }}
{{ end }}

{{ $bg_video := "" }}
{{ $bg_video_class := "" }}
{{ if $bg.video.filename }}
  {{ $bg_video = resources.Get (printf "media/%s" $bg.video.filename) }}
  {{ if $bg.video.flip }}
    {{ $bg_video_class = "flip" }}
  {{ end }}
{{ end }}

{{ if $bg.image.filename }}
  {{/* See Hugo note on linking assets in styles: https://github.com/gohugoio/hugoThemes#common-permalink-issues */}}
  {{ $bg_img := resources.Get (printf "media/%s" $bg.image.filename) }}
  {{ if $bg_img }}
    {{/* Exception for SVG as Hugo doesn't yet support image processing on SVG. */}}
    {{ if ne $bg_img.MediaType.SubType "svg" }}
      {{ $bg_img = $bg_img.Fit "1920x1920 webp" }}
    {{ end }}
    {{ $style_bg = printf "%sbackground-image: url('%s');" $style_bg $bg_img.Permalink }}
  {{ else }}
    {{ errorf "Couldn't find `%s` in the `assets/media/` folder - please add it." $bg.image.filename }}
  {{ end }}
  {{ with $bg.image.size }}
    {{/* Allow sizes: actual, cover, and contain. */}}
    {{ $style_bg = printf "%sbackground-size: %s;" $style_bg (replace . "actual" "auto") }}
  {{ end }}
  {{ with $bg.image.position }}
    {{/* Allow valid CSS positions including left, center, and right. */}}
    {{ $style_bg = printf "%sbackground-position: %s;" $style_bg . }}
  {{ end }}
{{ end }}

{{ with $bg.image.filters.brightness }}
  {{ $style_bg = printf "%sfilter: brightness(%s);" $style_bg (string .) }}
{{ end }}

{{ with $block.design.spacing.padding }}
  {{ $style_pad := printf "padding: %s;" (delimit . " ") }}
  {{ $style = print $style $style_pad }}
{{ end }}

{{/* Support for clip path (design.clip_path) */}}
{{ with $block.design.clip_path }}
  {{ $style_clip_path := printf "clip-path: %s;" . }}
  {{ $style = print $style $style_clip_path }}
{{ end }}

{{ with $block.design.css_style }}
  {{ $style = print $style . }}
{{ end }}

{{/* Fix Hugo's ContentBaseName returning wrong file base name when page section is within a bundle. */}}
{{ $hash_id := $block.id | default (printf "section-%s" (replace $block_type "." "-")) }}

{{ $css_classes := $block.design.css_class | default "" }}
{{ $extra_attributes := "" }}
{{ $use_container := true }}
{{ $columns := $block.design.columns | default "2" }}
{{ $use_cols := true }}

{{ $widget_class := printf "wg-%s" (replace (replace $block_type "." "-") "_" "-") }}

{{ $widget_config_file := printf "blocks/%s-config.html" $block_type }}



  {{if $use_cols}}
    <div class="row  {{if not $block.content.title | or (eq $columns "1") }}justify-content-center{{end}}">
    {{ if $wcBlock.Title }}
      {{ if eq $columns "1" }}
        <div class="section-heading col-12 mb-3 text-center">
          {{ with $wcBlock.Title }}<h1 class="mb-0">{{ . | markdownify | emojify }}</h1>{{ end }}
        </div>
      {{else}}
        <div class="section-heading col-12 col-lg-4 mb-3 mb-lg-0 d-flex flex-column align-items-center align-items-lg-start">
          {{ with $wcBlock.Title }}<h1 class="mb-0">{{ . | markdownify | emojify }}</h1>{{ end }}
        </div>
      {{end}}
    {{end}}
  {{end}}

  <!-- Experience widget -->
<div class="col-12 {{if eq $columns "2"}}col-lg-8{{end}}">
  {{ with $wcBlock.Content }}{{ . }}{{ end }}

  {{ if $wcBlock.Params.experience }}
  {{ $exp_len := len $wcBlock.Params.experience }}

  {{/* Default to user's custom order (as requested in #1761) as Hugo doesn't support multiple sorts on params. */}}
  {{ range $idx, $key := $wcBlock.Params.experience }}
  <div class="row experience">
    <!-- Timeline -->
    <div class="col-auto text-center flex-column d-none d-sm-flex">
      <div class="row h-50">
        <div class="col {{if gt $idx 0}}border-right{{end}}">&nbsp;</div>
        <div class="col">&nbsp;</div>
      </div>
      <div class="m-2">
        <span class="badge badge-pill border {{if not .date_end}}exp-fill{{end}}">&nbsp;</span>
      </div>
      <div class="row h-50">
        <div class="col {{if lt $idx (sub $exp_len 1)}}border-right{{end}}">&nbsp;</div>
        <div class="col">&nbsp;</div>
      </div>
    </div>
    <!-- Content -->
    <div class="col py-2">
      <div class="card">
        <div class="card-body">

          {{- if .company_logo}}
          {{- $svg_icon := resources.Get (printf "media/icons/brands/%s.svg" .company_logo) -}}
          {{ if not $svg_icon }}{{ errorf "Brand logo not found at `assets/media/icons/brands/%s.svg`" .company_logo }}{{end}}
          <div class="d-flex align-content-start">
            <div class="mr-2 mb-2">
              {{- with .company_url}}<a href="{{.}}" target="_blank" rel="noopener">{{end -}}
              <img src="{{ $svg_icon.RelPermalink }}" width="56px" height="56px" alt="{{.company | plainify}}" loading="lazy">
              {{- with .company_url}}</a>{{end -}}
            </div>
            <div>
          {{ end }}

              <h4 class="card-title exp-title text-muted mt-0 mb-1">{{.title | markdownify | emojify}} <small>{{.grade | markdownify | emojify}}</small></h4>
              <h4 class="card-title exp-company text-muted my-0">
                {{ if .advisor}}
                  {{with .advisor}}
                          <span>{{. | markdownify | emojify}}</span>				
                          <span class="middot-divider"></span>
                        {{end}}
                {{end}} 
                {{- with .company_url}}<a href="{{.}}" target="_blank" rel="noopener">{{end}}{{.company | markdownify | emojify}}{{with .company_url}}</a>{{end -}}
              </div>
              <div class="text-muted exp-meta">
                {{ (time .date_start) | time.Format ($wcBlock.Params.date_format | default "January 2006") }} â€“
                {{ if .date_end}}
                  {{ (time .date_end) | time.Format ($wcBlock.Params.date_format | default "January 2006") }}
                {{else}}
                  {{ i18n "present" | default "Present" }}
                {{end}}
                {{with .location}}
                  <span class="middot-divider"></span>
                  <span>{{.}}</span>
                {{end}}
                {{ if .major}}
				          {{with .major}}<div class="text-muted exp-meta">{{. | markdownify | emojify}}</div>{{end}}
                {{end}}
              </div>

          {{- if .company_logo}}
            </div>
          </div>
          {{end}}

          {{with .description}}<div class="card-text">{{. | markdownify | emojify}}</div>{{end}}
        </div>
      </div>
    </div>
  </div>
  {{end}}
  {{end}}
</div>


  
